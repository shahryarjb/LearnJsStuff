# نقشه راه جلوگیری از re-render در React

- https://www.developerway.com/posts/react-re-renders-guide
- https://beta.reactjs.org/learn/preserving-and-resetting-state
- https://www.developerway.com/posts/how-to-write-performant-react-apps-with-context
- https://github.com/welldone-software/why-did-you-render

---
در این بخش ما سعی می کنیم خلاصه از این آموزش کامل در رابطه با re-render شدن کامپوننت ها در ReactJS قرار بدیم چه چیزی باعث این پروسه می شود و همینطور چطور جلوی آن را بگیریم.
> همچنین شامل بسیاری از الگوهای مهم است که می تواند به جلوگیری از رندرهای مجدد کمک کند و چند آنتی پترن که منجر به رندرهای مجدد غیرضروری و در نتیجه عملکرد ضعیف می شود.

زمانی که می خواهیم در مورد عملکرد React صحبت کنیم، دو مرحله اصلی وجود دارد که باید به آنها اهمیت بدیم:

- `رندر اولیه` - زمانی اتفاق می افتد که یک مؤلفه برای اولین بار روی صفحه ظاهر می شود
- `دوباره رندر شدن` - هر رندر متوالی از یک مؤلفه که قبلاً روی صفحه ظاهر شده است


رندر مجدد زمانی اتفاق می‌افتد که React باید برنامه را با داده‌های جدید به‌روزرسانی کند. معمولاً این در نتیجه تعامل کاربر با برنامه یا برخی داده‌های خارجی از طریق درخواست های ناهمزمان یا برخی از مدل‌های اشتراکی ارسال می شود اتفاق می‌افتد.

> برنامه‌های غیرتعاملی که هیچ به‌روزرسانی داده ناهمزمانی ندارند، هرگز دوباره رندر نمی‌شوند و بنابراین نیازی به بهینه‌سازی عملکرد رندر مجدد ندارند.


---


### رندر ضروری و غیر ضروری چیست؟

`رندر لازم` - رندر مجدد مؤلفه ای که منبع تغییرات است یا مؤلفه ای که مستقیماً از اطلاعات جدید استفاده می کند. به عنوان مثال، اگر کاربر در یک فیلد ورودی تایپ کند، مؤلفه ای که وضعیت آن را مدیریت می کند باید با هر بار زدن کلید، خود را به روز کند، یعنی دوباره ارائه یا ظاهر شود.

`رندر مجدد غیرضروری` - رندر مجدد مولفه ای که از طریق مکانیسم های رندرهای مختلف به دلیل اشتباه یا معماری ناکارآمد برنامه از طریق برنامه دوباره انجام می شود. به عنوان مثال، اگر کاربر در یک فیلد ورودی تایپ کند و کل صفحه با هر بار زدن کلید مجدداً رندر شود، صفحه بدون اینکه به آن نیاز داشته باشیم دوباره رندر شده است.

> **رندرهای غیرضروری به خودی خود مشکلی ایجاد نمی کنند: React بسیار سریع است و معمولاً بدون اینکه کاربران متوجه چیزی شوند با آنها مقابله می کند.**
> 
با این حال، اگر رندرهای مجدد خیلی زیاد و/یا روی اجزای بسیار سنگین (مواردی که هزینه زیادی برای اعمال دوباره آن ها نیاز است) اتفاق بیفتد، این امر می‌تواند منجر به ایجاد تاخیر در تجربه کاربری شود، تأخیر قابل مشاهده در هر تعامل یا حتی عدم پاسخگویی کامل برنامه می تواند با بزرگ شدن اپ شما چندین برابر خودش را نشان بدهد.

---
### چه وقتی کامپوننت React خودش را دوباره رندر می کند؟

چهار دلیل وجود دارد که یک کامپوننت خود را مجدداً رندر می کند:
تغییر حالت، رندرهای والد (یا فرزندان)، تغییرات زمینه، و تغییر قلاب ها. همچنین یک افسانه بزرگ وجود دارد: این که رندرهای مجدد زمانی اتفاق می‌افتد که اجزای سازنده تغییر می‌کنند. به خودی خود درست نیست (توضیح زیر را ببینید).

#### دلیل دوباره رندر شدن: تغییر State

هنگامی که State یک کامپوننت تغییر می کند، خود را دوباره render می کند. معمولاً یا در یک callback یا در قلاب useEffect اتفاق می افتد.

> **تغییرات State منبع "ریشه" همه رندرها هستند.**


کد نمونه نویسنده اصلی این مقاله برای این بخش: https://codesandbox.io/s/part2-1-re-renders-because-of-state-ngh8uc?file=/src/App.tsx

<img width="1246" alt="part2-state-changes-example" src="https://user-images.githubusercontent.com/8413604/219853256-1f10b2fa-1030-4e56-b178-63ef3fcd366b.png">

ویدیو خلاصه این بخش از زبان نویسنده محتوا اصلی:

https://www.youtube.com/watch?v=ARWX1XdghLk&t=244

---

#### دلیل دوباره رندر شدن: دوباره render شدن والد

اگر والد یک کامپوننت دوباره render شود خود کامپوننت نیز دوباره رندر می گردد. یا اگر از جهت مخالف به این موضوع نگاه کنیم: وقتی یک کامپوننت دوباره رندر می‌شود، همه فرزندان خود را نیز دوباره رندر می‌کند.

> همیشه از درخت «پایین» می‌رود: رندر مجدد یک فرزند باعث رندر مجدد والدین نمی‌شود. در لینک زیر می توانید اطلاعات بیشتری را بدست بیاورید https://www.developerway.com/posts/react-elements-children-parents


کد نمونه برای این بخش از نویسنده محتوای اصلی:

https://codesandbox.io/s/part-2-2-re-renders-because-of-parent-b0xvxt?file=/src/App.tsx

<img width="1239" alt="part2-parent-example" src="https://user-images.githubusercontent.com/8413604/219853473-7a7e4f4f-0975-48bc-a8ec-fa414bd9b9d1.png">


---

#### دلیل دوباره رندر شدن: تغییر در context

هنگامی که مقدار در Context Provider تغییر می‌کند، همه مؤلفه‌هایی که از این Context استفاده می‌کنند، مجدداً رندر می‌شوند، حتی اگر به طور مستقیم از بخش تغییر یافته داده استفاده نکنند. با حفظ کردن مستقیم نمی توان از این رندرها جلوگیری کرد، اما چند راه حل وجود دارد که می تواند آن را شبیه سازی کنیم که در ادامه به آن ها اشاره می کنیم.

نمونه کد از نویسنده محتوای اصلی

https://codesandbox.io/s/part-2-3-re-render-because-of-context-i75lwh?file=/src/App.tsx

<img width="1237" alt="part2-context-example" src="https://user-images.githubusercontent.com/8413604/219853580-84803515-6a9f-49a6-bc26-40c4e7a74a87.png">

---
